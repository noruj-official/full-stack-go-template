{{define "base"}}
<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true', sidebarOpen: false }"
    :class="{ 'dark': darkMode }" :data-theme="darkMode ? 'dark' : 'light'"
    x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{.Description}}">
    <title>{{.Title}} | Go Starter</title>

    <!-- Tailwind CSS Output -->
    <link rel="stylesheet" href="/static/css/output.css">

    <!-- Local Vendor JS -->
    <script src="/static/vendor/htmx.min.js"></script>
    <script defer src="/static/vendor/alpine.min.js"></script>
    <script src="/static/vendor/lucide.min.js"></script>

    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body class="min-h-screen" hx-boost="true">
    {{if .ShowSidebar}}
    <div class="drawer lg:drawer-open font-sans">
        <input id="my-drawer-4" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content flex flex-col h-screen overflow-hidden bg-base-200">
            <!-- App Navbar -->
            <nav class="navbar w-full bg-base-100 border-b border-base-200 z-10 sticky top-0">
                <div class="flex-none">
                    <label for="my-drawer-4" aria-label="open sidebar"
                        class="btn btn-square btn-ghost text-base-content/70">
                        <i data-lucide="menu" class="w-5 h-5 my-1.5 inline-block"></i>
                    </label>
                </div>
                <div class="flex-1 px-4">
                    <span class="text-xl font-bold text-base-content">Go Starter</span>
                </div>
                <div class="flex-none flex items-center gap-2">
                    <!-- Dark mode toggle -->
                    <button @click="darkMode = !darkMode" class="btn btn-ghost btn-circle text-base-content/70">
                        <i x-show="!darkMode" data-lucide="moon" class="w-5 h-5"></i>
                        <i x-show="darkMode" data-lucide="sun" class="w-5 h-5" x-cloak></i>
                    </button>

                    <!-- User Dropdown -->
                    {{if .User}}
                    <div x-data="{ open: false }" class="relative z-50">
                        <button @click="open = !open" class="btn btn-ghost btn-circle avatar">
                            <div
                                class="w-9 h-9 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-sm font-medium">
                                {{slice .User.Name 0 1}}
                            </div>
                        </button>
                        <div x-show="open" x-transition:enter="transition ease-out duration-200"
                            x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-150"
                            x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
                            @click.away="open = false"
                            class="absolute right-0 mt-2 w-56 bg-base-100 border border-base-200 shadow-xl rounded-box z-50"
                            x-cloak>

                            <div class="px-4 py-2 border-b border-base-200">
                                <p class="text-sm font-medium text-base-content">{{.User.Name}}</p>
                                <p class="text-xs text-base-content/70">{{.User.Email}}</p>
                            </div>
                            <ul class="menu menu-sm">
                                <li><a href="#"><i data-lucide="user" class="w-4 h-4"></i> Profile</a></li>
                                <li><a href="#"><i data-lucide="settings" class="w-4 h-4"></i> Settings</a></li>
                                <div class="divider my-1"></div>
                                <li>
                                    <form action="/logout" method="POST" class="w-full">
                                        <button type="submit"
                                            class="flex items-center gap-2 text-error hover:text-error/80 w-full px-2">
                                            <i data-lucide="log-out" class="w-4 h-4"></i> Logout
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                    {{end}}
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-4 lg:p-8">
                <div class="max-w-7xl mx-auto animate-fade-in">
                    {{template "content" .}}
                </div>
            </main>
        </div>

        <!-- Sidebar Drawer -->
        <div class="drawer-side z-20 is-drawer-close:overflow-visible">
            <label for="my-drawer-4" aria-label="close sidebar" class="drawer-overlay"></label>
            <div
                class="flex min-h-full flex-col items-start bg-base-200 border-r border-base-300 is-drawer-close:w-14 is-drawer-open:w-64 transition-all duration-300">
                <ul class="menu w-full grow gap-2 p-2">
                    <!-- Home Link (Added explicitly so users can go back to landing) -->
                    <li>
                        <a href="/" class="is-drawer-close:tooltip is-drawer-close:tooltip-right" data-tip="Home">
                            <i data-lucide="home" class="w-5 h-5 my-1.5 inline-block"></i>
                            <span class="is-drawer-close:hidden font-medium">Home</span>
                        </a>
                    </li>

                    <!-- Dashboard -->
                    <li>
                        <a href="/dashboard" class="is-drawer-close:tooltip is-drawer-close:tooltip-right"
                            data-tip="Dashboard">
                            <i data-lucide="layout-dashboard" class="w-5 h-5 my-1.5 inline-block"></i>
                            <span class="is-drawer-close:hidden font-medium">Dashboard</span>
                        </a>
                    </li>

                    <!-- Users -->
                    <li>
                        <a href="/users" class="is-drawer-close:tooltip is-drawer-close:tooltip-right" data-tip="Users">
                            <i data-lucide="users" class="w-5 h-5 my-1.5 inline-block"></i>
                            <span class="is-drawer-close:hidden font-medium">Users</span>
                        </a>
                    </li>

                    <!-- Settings -->
                    <li>
                        <a href="#" class="is-drawer-close:tooltip is-drawer-close:tooltip-right" data-tip="Settings">
                            <i data-lucide="settings" class="w-5 h-5 my-1.5 inline-block"></i>
                            <span class="is-drawer-close:hidden font-medium">Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    {{else}}
    <!-- Default Layout (No Sidebar) -->
    {{template "content" .}}
    {{end}}

    <div id="modal-container" class="relative z-50"></div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Re-initialize icons after HTMX content swap
        document.body.addEventListener('htmx:afterSwap', function () {
            lucide.createIcons();
        });

        // Show toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-primary-500';

            toast.className = `${bgColor} text-white px-4 py-3 rounded-xl shadow-lg animate-slide-up flex items-center gap-2`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-2 hover:opacity-75">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;

            container.appendChild(toast);
            lucide.createIcons();

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                toast.style.transition = 'all 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Handle HTMX events for toasts
        document.body.addEventListener('userCreated', () => showToast('User created successfully!'));
        document.body.addEventListener('userUpdated', () => showToast('User updated successfully!'));
        document.body.addEventListener('userDeleted', () => showToast('User deleted successfully!'));
    </script>
</body>

</html>
{{end}}